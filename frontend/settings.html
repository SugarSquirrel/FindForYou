<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨­å®š | æ—¥å¸¸ç‰©å“æœå°‹åŠ©æ‰‹</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        .header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
        }
        .back-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: #fff;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        .back-btn:hover { background: rgba(255,255,255,0.2); }
        h1 { font-size: 24px; }
        
        .card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
        }
        .card h2 {
            font-size: 18px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .card p.desc {
            color: #aaa;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        /* æŒ‰éˆ•æ¨£å¼ */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #38ef7d, #11998e);
            color: #fff;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(56,239,125,0.4); }
        .btn-danger { background: #f5576c; color: #fff; }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; }
        .btn-preview { background: #4a90d9; color: #fff; padding: 8px 12px; font-size: 12px; }
        
        /* è¼¸å…¥æ¡† */
        input, select, textarea {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: #fff;
            padding: 10px 14px;
            border-radius: 8px;
            font-size: 14px;
            width: 100%;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #38ef7d;
        }
        input::placeholder, textarea::placeholder { color: rgba(255,255,255,0.5); }
        
        /* ç‰©å“å¡ç‰‡ */
        .object-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }
        .object-card {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        .object-card:hover {
            border-color: #38ef7d;
            transform: translateY(-2px);
        }
        .object-card img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            background: rgba(255,255,255,0.05);
        }
        .object-card .info {
            padding: 12px;
        }
        .object-card .name {
            font-weight: 500;
            margin-bottom: 4px;
        }
        .object-card .meta {
            font-size: 12px;
            color: #888;
        }
        .object-card .badge {
            display: inline-block;
            background: rgba(56,239,125,0.2);
            color: #38ef7d;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            margin-top: 6px;
        }
        
        /* æ–°å¢ç‰©å“æŒ‰éˆ• */
        .add-object-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 200px;
            background: rgba(56,239,125,0.1);
            border: 2px dashed rgba(56,239,125,0.3);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .add-object-btn:hover {
            background: rgba(56,239,125,0.2);
            border-color: #38ef7d;
        }
        .add-object-btn .icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        .add-object-btn span {
            color: #38ef7d;
            font-weight: 500;
        }
        
        /* Modal */
        .modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background: rgba(30,30,50,0.98);
            border-radius: 16px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
        }
        .modal-content h3 {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .modal-content .form-group {
            margin-bottom: 16px;
        }
        .modal-content label {
            display: block;
            color: #aaa;
            margin-bottom: 6px;
            font-size: 14px;
        }
        .modal-content .btn-group {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        /* åœ–ç‰‡ä¸Šå‚³å€åŸŸ */
        .upload-area {
            border: 2px dashed rgba(255,255,255,0.3);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .upload-area:hover {
            border-color: #38ef7d;
            background: rgba(56,239,125,0.1);
        }
        .upload-area.has-image {
            padding: 10px;
        }
        .upload-area img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
        }
        .upload-area .placeholder {
            color: #888;
        }
        .upload-area .placeholder .icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        /* æ”å½±æ©Ÿåˆ—è¡¨ */
        .camera-list { display: flex; flex-direction: column; gap: 12px; }
        .camera-item {
            display: grid;
            grid-template-columns: 80px 1fr 1fr auto;
            gap: 12px;
            align-items: center;
            padding: 16px;
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
        }
        .camera-id { font-weight: bold; color: #38ef7d; }
        .btn-group { display: flex; gap: 8px; }
        
        /* Toggle Switch */
        .switch {
            position: relative;
            width: 60px;
            height: 34px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(245,87,108,0.5);
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: #38ef7d; }
        input:checked + .slider:before { transform: translateX(26px); }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #38ef7d;
            color: #000;
            padding: 12px 24px;
            border-radius: 8px;
            animation: slideIn 0.3s ease;
            z-index: 2000;
        }
        @keyframes slideIn {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* ç‹€æ…‹æ¨™ç±¤ */
        .status { padding: 4px 12px; border-radius: 12px; font-size: 12px; }
        .status.active { background: rgba(56,239,125,0.2); color: #38ef7d; }
        .status.inactive { background: rgba(245,87,108,0.2); color: #f5576c; }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #888;
        }
        .empty-state .icon { font-size: 48px; margin-bottom: 15px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="/" class="back-btn">â† è¿”å›</a>
            <h1>âš™ï¸ è¨­å®š</h1>
        </div>
        
        <!-- æˆ‘çš„ç‰©å“ -->
        <div class="card">
            <h2>ğŸ“¦ æˆ‘çš„ç‰©å“</h2>
            <p class="desc">è¨»å†Šä½ çš„å€‹äººç‰©å“ï¼Œç³»çµ±æœƒé€é AI ç‰¹å¾µæ¯”å°ä¾†è­˜åˆ¥å®ƒå€‘ã€‚æ‹æ”å¤šå¼µä¸åŒè§’åº¦çš„ç…§ç‰‡å¯æé«˜è­˜åˆ¥æº–ç¢ºåº¦ã€‚</p>
            
            <div class="object-grid" id="objectGrid">
                <!-- å‹•æ…‹å¡«å…¥ -->
            </div>
        </div>
        
        <!-- æ”å½±æ©Ÿé…ç½® -->
        <div class="card">
            <h2>ğŸ“¹ æ”å½±æ©Ÿé…ç½®</h2>
            <p class="desc">è¨­å®šæ¯å€‹æ”å½±æ©Ÿçš„åç¨±èˆ‡æ‰€åœ¨ä½ç½®ï¼Œåµæ¸¬çµæœæœƒè‡ªå‹•ä½¿ç”¨æ”å½±æ©Ÿä½ç½®ã€‚</p>
            
            <div class="camera-list" id="cameraList"></div>
            
            <div style="display:grid; grid-template-columns: 100px 1fr 1fr auto; gap:12px; padding:16px; background:rgba(56,239,125,0.1); border-radius:12px; border:2px dashed rgba(56,239,125,0.3); margin-top:16px;">
                <input type="number" id="newCameraId" placeholder="ç·¨è™Ÿ" min="0" max="10">
                <input type="text" id="newCameraName" placeholder="æ”å½±æ©Ÿåç¨±">
                <input type="text" id="newCameraLocation" placeholder="æ‰€åœ¨ä½ç½®">
                <button class="btn btn-primary" onclick="addCamera()">æ–°å¢</button>
            </div>
        </div>
        
        <!-- åµæ¸¬åˆ°çš„æ”å½±æ©Ÿ -->
        <div class="card">
            <h2>ğŸ” åµæ¸¬åˆ°çš„æ”å½±æ©Ÿ</h2>
            <p class="desc">ç³»çµ±åµæ¸¬åˆ°çš„å¯ç”¨æ”å½±æ©Ÿæ¸…å–®</p>
            <div id="availableCameras">è¼‰å…¥ä¸­...</div>
        </div>
        
        <!-- è‡ªå‹•åµæ¸¬ -->
        <div class="card">
            <h2>â±ï¸ è‡ªå‹•åµæ¸¬</h2>
            <p class="desc">å•Ÿç”¨å¾Œç³»çµ±æœƒå®šæ™‚è‡ªå‹•æƒææ”å½±æ©Ÿä¸¦è¨˜éŒ„ç‰©å“ä½ç½®</p>
            
            <div style="display:flex; align-items:center; justify-content:space-between; padding:16px; background:rgba(0,0,0,0.2); border-radius:12px;">
                <div>
                    <span style="font-size:16px;">è‡ªå‹•åµæ¸¬</span>
                    <span id="schedulerStatus" class="status inactive">å·²åœæ­¢</span>
                </div>
                <label class="switch">
                    <input type="checkbox" id="schedulerSwitch" onchange="toggleScheduler()">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div style="margin-top:15px; display:grid; grid-template-columns: 1fr auto; gap:12px; align-items:center;">
                <label style="color:#aaa;">åµæ¸¬é–“éš”ï¼ˆç§’ï¼‰</label>
                <input type="number" id="intervalInput" value="30" min="5" max="300" style="width:100px; text-align:center;" onchange="setDetectionInterval()">
            </div>
        </div>
        
        <!-- å¸¸ç”¨ç‰©å“å¿«æ· -->
        <div class="card">
            <h2>â­ å¸¸ç”¨ç‰©å“å¿«æ·</h2>
            <p class="desc">è‡ªè¨‚é¦–é é¡¯ç¤ºçš„å¸¸ç”¨ç‰©å“å¿«æ·æŒ‰éˆ•</p>
            
            <div id="quickItemsList" style="display:flex; flex-wrap:wrap; gap:8px; margin-bottom:20px;"></div>
            
            <div style="display:grid; grid-template-columns: 1fr 1fr 80px auto; gap:12px; padding:16px; background:rgba(255,215,0,0.1); border-radius:12px; border:2px dashed rgba(255,215,0,0.3);">
                <input type="text" id="newQuickItemName" placeholder="ç‰©å“åç¨±">
                <input type="text" id="newQuickItemIcon" placeholder="åœ–ç¤º (å¦‚: ğŸ“±)">
                <input type="number" id="newQuickItemOrder" placeholder="é †åº" min="1" max="10" value="1">
                <button class="btn btn-primary" onclick="addQuickItem()">æ–°å¢</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '';  // Same origin
        
        // ========================================
        // ç‰©å“ç®¡ç†åŠŸèƒ½ (æ–°)
        // ========================================
        
        async function loadObjects() {
            try {
                const res = await fetch(`${API_BASE}/api/objects`);
                const data = await res.json();
                renderObjectGrid(data.objects || []);
            } catch (e) {
                console.error('è¼‰å…¥ç‰©å“å¤±æ•—', e);
                document.getElementById('objectGrid').innerHTML = `
                    <div class="empty-state">
                        <div class="icon">âš ï¸</div>
                        <p>ç„¡æ³•é€£æ¥å¾Œç«¯æœå‹™</p>
                    </div>
                `;
            }
        }
        
        function renderObjectGrid(objects) {
            const container = document.getElementById('objectGrid');
            
            let html = objects.map(obj => `
                <div class="object-card" onclick="showObjectDetail('${obj.id}')">
                    <img src="${obj.thumbnail || 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23333%22 width=%22100%22 height=%22100%22/><text x=%2250%22 y=%2255%22 text-anchor=%22middle%22 fill=%22%23666%22 font-size=%2230%22>ğŸ“¦</text></svg>'}" alt="${obj.name_zh}">
                    <div class="info">
                        <div class="name">${obj.name_zh}</div>
                        <div class="meta">${obj.name}</div>
                        <div class="badge">${obj.embedding_count} å¼µç…§ç‰‡</div>
                    </div>
                </div>
            `).join('');
            
            // æ–°å¢ç‰©å“æŒ‰éˆ•
            html += `
                <div class="add-object-btn" onclick="showRegisterModal()">
                    <div class="icon">â•</div>
                    <span>æ–°å¢ç‰©å“</span>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        // é¡¯ç¤ºè¨»å†Š Modal
        function showRegisterModal() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'registerModal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h3>ğŸ“¦ è¨»å†Šæ–°ç‰©å“</h3>
                    
                    <div class="form-group">
                        <label>ç‰©å“ç…§ç‰‡</label>
                        <div class="upload-area" id="uploadArea" onclick="document.getElementById('imageInput').click()">
                            <div class="placeholder">
                                <div class="icon">ğŸ“·</div>
                                <div>é»æ“Šä¸Šå‚³ç…§ç‰‡</div>
                            </div>
                        </div>
                        <input type="file" id="imageInput" accept="image/*" style="display:none" onchange="previewImage(this)">
                    </div>
                    
                    <div class="form-group">
                        <label>ç‰©å“åç¨± (è‹±æ–‡ ID)</label>
                        <input type="text" id="regName" placeholder="ä¾‹å¦‚: my_wallet">
                    </div>
                    
                    <div class="form-group">
                        <label>ä¸­æ–‡åç¨±</label>
                        <input type="text" id="regNameZh" placeholder="ä¾‹å¦‚: æˆ‘çš„éŒ¢åŒ…">
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="closeModal('registerModal')">å–æ¶ˆ</button>
                        <button class="btn btn-primary" onclick="registerObject()">è¨»å†Š</button>
                    </div>
                </div>
            `;
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModal('registerModal');
            });
            
            document.body.appendChild(modal);
        }
        
        function previewImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const area = document.getElementById('uploadArea');
                    area.classList.add('has-image');
                    area.innerHTML = `<img src="${e.target.result}" alt="é è¦½">`;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        async function registerObject() {
            const imageInput = document.getElementById('imageInput');
            const name = document.getElementById('regName').value.trim();
            const nameZh = document.getElementById('regNameZh').value.trim();
            
            if (!imageInput.files || !imageInput.files[0]) {
                showToast('è«‹é¸æ“‡ç…§ç‰‡');
                return;
            }
            if (!name) {
                showToast('è«‹è¼¸å…¥ç‰©å“åç¨±');
                return;
            }
            if (!nameZh) {
                showToast('è«‹è¼¸å…¥ä¸­æ–‡åç¨±');
                return;
            }
            
            const formData = new FormData();
            formData.append('image', imageInput.files[0]);
            formData.append('name', name);
            formData.append('name_zh', nameZh);
            
            try {
                showToast('è¨»å†Šä¸­...');
                const res = await fetch(`${API_BASE}/api/objects/register`, {
                    method: 'POST',
                    body: formData
                });
                const data = await res.json();
                
                if (data.success) {
                    showToast(`å·²è¨»å†Š: ${nameZh}`);
                    closeModal('registerModal');
                    loadObjects();
                } else {
                    showToast(data.detail || 'è¨»å†Šå¤±æ•—');
                }
            } catch (e) {
                console.error('è¨»å†Šå¤±æ•—', e);
                showToast('è¨»å†Šå¤±æ•—');
            }
        }
        
        // é¡¯ç¤ºç‰©å“è©³æƒ…
        async function showObjectDetail(objId) {
            try {
                const res = await fetch(`${API_BASE}/api/objects/${objId}`);
                const data = await res.json();
                
                if (!data.success) {
                    showToast('è¼‰å…¥å¤±æ•—');
                    return;
                }
                
                const obj = data.object;
                
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.id = 'detailModal';
                modal.innerHTML = `
                    <div class="modal-content">
                        <h3>ğŸ“¦ ${obj.name_zh}</h3>
                        
                        <div style="margin-bottom:16px;">
                            <div style="display:flex; flex-wrap:wrap; gap:8px;">
                                ${obj.images.map(img => `
                                    <img src="${img}" style="width:80px; height:80px; object-fit:cover; border-radius:8px;">
                                `).join('')}
                            </div>
                        </div>
                        
                        <div style="background:rgba(0,0,0,0.2); padding:12px; border-radius:8px; margin-bottom:16px;">
                            <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                                <span style="color:#888;">ID</span>
                                <span>${obj.id}</span>
                            </div>
                            <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                                <span style="color:#888;">è‹±æ–‡åç¨±</span>
                                <span>${obj.name}</span>
                            </div>
                            <div style="display:flex; justify-content:space-between;">
                                <span style="color:#888;">ç…§ç‰‡æ•¸é‡</span>
                                <span>${obj.embedding_count}</span>
                            </div>
                        </div>
                        
                        <div class="btn-group" style="justify-content:space-between;">
                            <button class="btn btn-danger" onclick="deleteObject('${obj.id}')">åˆªé™¤ç‰©å“</button>
                            <div style="display:flex; gap:8px;">
                                <button class="btn btn-secondary" onclick="closeModal('detailModal')">é—œé–‰</button>
                                <button class="btn btn-primary" onclick="addMorePhotos('${obj.id}')">æ–°å¢ç…§ç‰‡</button>
                            </div>
                        </div>
                    </div>
                `;
                
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) closeModal('detailModal');
                });
                
                document.body.appendChild(modal);
            } catch (e) {
                console.error('è¼‰å…¥ç‰©å“è©³æƒ…å¤±æ•—', e);
                showToast('è¼‰å…¥å¤±æ•—');
            }
        }
        
        function addMorePhotos(objId) {
            closeModal('detailModal');
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'addPhotoModal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h3>ğŸ“· æ–°å¢ç…§ç‰‡</h3>
                    
                    <div class="form-group">
                        <div class="upload-area" id="uploadAreaAdd" onclick="document.getElementById('imageInputAdd').click()">
                            <div class="placeholder">
                                <div class="icon">ğŸ“·</div>
                                <div>é»æ“Šä¸Šå‚³ç…§ç‰‡</div>
                            </div>
                        </div>
                        <input type="file" id="imageInputAdd" accept="image/*" style="display:none" onchange="previewImageAdd(this)">
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="closeModal('addPhotoModal')">å–æ¶ˆ</button>
                        <button class="btn btn-primary" onclick="uploadMorePhoto('${objId}')">ä¸Šå‚³</button>
                    </div>
                </div>
            `;
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModal('addPhotoModal');
            });
            
            document.body.appendChild(modal);
        }
        
        function previewImageAdd(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const area = document.getElementById('uploadAreaAdd');
                    area.classList.add('has-image');
                    area.innerHTML = `<img src="${e.target.result}" alt="é è¦½">`;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        async function uploadMorePhoto(objId) {
            const imageInput = document.getElementById('imageInputAdd');
            
            if (!imageInput.files || !imageInput.files[0]) {
                showToast('è«‹é¸æ“‡ç…§ç‰‡');
                return;
            }
            
            const formData = new FormData();
            formData.append('image', imageInput.files[0]);
            
            try {
                showToast('ä¸Šå‚³ä¸­...');
                const res = await fetch(`${API_BASE}/api/objects/${objId}/images`, {
                    method: 'POST',
                    body: formData
                });
                const data = await res.json();
                
                if (data.success) {
                    showToast('ç…§ç‰‡å·²æ–°å¢');
                    closeModal('addPhotoModal');
                    loadObjects();
                } else {
                    showToast(data.detail || 'ä¸Šå‚³å¤±æ•—');
                }
            } catch (e) {
                console.error('ä¸Šå‚³å¤±æ•—', e);
                showToast('ä¸Šå‚³å¤±æ•—');
            }
        }
        
        async function deleteObject(objId) {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤ç‰©å“ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) return;
            
            try {
                const res = await fetch(`${API_BASE}/api/objects/${objId}`, {
                    method: 'DELETE'
                });
                const data = await res.json();
                
                if (data.success) {
                    showToast('å·²åˆªé™¤');
                    closeModal('detailModal');
                    loadObjects();
                } else {
                    showToast('åˆªé™¤å¤±æ•—');
                }
            } catch (e) {
                console.error('åˆªé™¤å¤±æ•—', e);
                showToast('åˆªé™¤å¤±æ•—');
            }
        }
        
        function closeModal(id) {
            document.getElementById(id)?.remove();
        }
        
        // ========================================
        // æ”å½±æ©Ÿç›¸é—œåŠŸèƒ½
        // ========================================
        
        async function loadConfig() {
            try {
                const res = await fetch(`${API_BASE}/api/cameras/config`);
                const data = await res.json();
                renderCameraList(data.cameras || {});
            } catch (e) {
                console.error('è¼‰å…¥é…ç½®å¤±æ•—', e);
            }
        }
        
        async function loadAvailableCameras() {
            try {
                const res = await fetch(`${API_BASE}/api/cameras`);
                const data = await res.json();
                const container = document.getElementById('availableCameras');
                
                if (data.cameras && data.cameras.length > 0) {
                    container.innerHTML = data.cameras.map(c => 
                        `<span class="status active" style="margin-right:8px;">ğŸ“¹ ${c.name}</span>`
                    ).join('');
                } else {
                    container.innerHTML = '<span style="color:#aaa">æœªåµæ¸¬åˆ°æ”å½±æ©Ÿ</span>';
                }
            } catch (e) {
                document.getElementById('availableCameras').innerHTML = '<span style="color:#f5576c">ç„¡æ³•é€£æ¥å¾Œç«¯</span>';
            }
        }
        
        function renderCameraList(cameras) {
            const container = document.getElementById('cameraList');
            const entries = Object.entries(cameras);
            
            if (entries.length === 0) {
                container.innerHTML = '<p style="color:#aaa;text-align:center;padding:20px;">å°šæœªé…ç½®ä»»ä½•æ”å½±æ©Ÿ</p>';
                return;
            }
            
            container.innerHTML = entries.map(([id, cam]) => `
                <div class="camera-item" data-id="${id}">
                    <span class="camera-id">æ”å½±æ©Ÿ ${id}</span>
                    <input type="text" value="${cam.name}" placeholder="åç¨±" onchange="updateCamera('${id}')">
                    <input type="text" value="${cam.location}" placeholder="ä½ç½®" onchange="updateCamera('${id}')">
                    <div class="btn-group">
                        <button class="btn btn-preview" onclick="previewCamera('${id}')">ğŸ‘ é è¦½</button>
                        <button class="btn btn-danger" onclick="deleteCamera('${id}')">åˆªé™¤</button>
                    </div>
                </div>
            `).join('');
        }
        
        async function previewCamera(id) {
            showToast('è¼‰å…¥é è¦½ä¸­...');
            try {
                const res = await fetch(`${API_BASE}/api/cameras/${id}/preview`);
                const data = await res.json();
                if (data.success) {
                    const modal = document.createElement('div');
                    modal.className = 'modal';
                    modal.id = 'previewModal';
                    modal.innerHTML = `
                        <div class="modal-content" style="max-width:700px;">
                            <h3>ğŸ“¹ æ”å½±æ©Ÿ ${id} é è¦½</h3>
                            <img src="${data.image}" style="width:100%; border-radius:8px; margin-bottom:15px;">
                            <div class="btn-group">
                                <button class="btn btn-secondary" onclick="closeModal('previewModal')">é—œé–‰</button>
                                <button class="btn btn-primary" onclick="closeModal('previewModal'); previewCamera('${id}')">é‡æ–°æ•´ç†</button>
                            </div>
                        </div>
                    `;
                    modal.addEventListener('click', (e) => { if (e.target === modal) closeModal('previewModal'); });
                    document.body.appendChild(modal);
                }
            } catch (e) {
                showToast('é è¦½å¤±æ•—');
            }
        }
        
        async function updateCamera(id) {
            const item = document.querySelector(`.camera-item[data-id="${id}"]`);
            const name = item.querySelectorAll('input')[0].value;
            const location = item.querySelectorAll('input')[1].value;
            
            await fetch(`${API_BASE}/api/cameras/config`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ camera_id: id, name, location, enabled: true })
            });
            showToast('é…ç½®å·²å„²å­˜');
        }
        
        async function addCamera() {
            const id = document.getElementById('newCameraId').value;
            const name = document.getElementById('newCameraName').value || `æ”å½±æ©Ÿ ${id}`;
            const location = document.getElementById('newCameraLocation').value || 'æœªè¨­å®š';
            
            if (!id) { alert('è«‹è¼¸å…¥æ”å½±æ©Ÿç·¨è™Ÿ'); return; }
            
            await fetch(`${API_BASE}/api/cameras/config`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ camera_id: id, name, location, enabled: true })
            });
            
            document.getElementById('newCameraId').value = '';
            document.getElementById('newCameraName').value = '';
            document.getElementById('newCameraLocation').value = '';
            
            showToast('æ”å½±æ©Ÿå·²æ–°å¢');
            loadConfig();
        }
        
        async function deleteCamera(id) {
            if (!confirm(`ç¢ºå®šè¦åˆªé™¤æ”å½±æ©Ÿ ${id} çš„é…ç½®ï¼Ÿ`)) return;
            await fetch(`${API_BASE}/api/cameras/config/${id}`, { method: 'DELETE' });
            showToast('é…ç½®å·²åˆªé™¤');
            loadConfig();
        }
        
        // ========================================
        // æ’ç¨‹å™¨æ§åˆ¶
        // ========================================
        
        async function loadSchedulerStatus() {
            try {
                const res = await fetch(`${API_BASE}/api/health`);
                const data = await res.json();
                
                const switchEl = document.getElementById('schedulerSwitch');
                const statusEl = document.getElementById('schedulerStatus');
                
                if (data.scheduler_running) {
                    switchEl.checked = true;
                    statusEl.className = 'status active';
                    statusEl.textContent = 'é‹è¡Œä¸­';
                } else {
                    switchEl.checked = false;
                    statusEl.className = 'status inactive';
                    statusEl.textContent = 'å·²åœæ­¢';
                }
            } catch (e) {
                console.error('è¼‰å…¥æ’ç¨‹å™¨ç‹€æ…‹å¤±æ•—', e);
            }
        }
        
        async function toggleScheduler() {
            const switchEl = document.getElementById('schedulerSwitch');
            const statusEl = document.getElementById('schedulerStatus');
            const action = switchEl.checked ? 'start' : 'stop';
            
            try {
                const res = await fetch(`${API_BASE}/api/scheduler/${action}`, { method: 'POST' });
                const data = await res.json();
                
                if (data.success) {
                    if (switchEl.checked) {
                        statusEl.className = 'status active';
                        statusEl.textContent = 'é‹è¡Œä¸­';
                        showToast('è‡ªå‹•åµæ¸¬å·²å•Ÿå‹•');
                    } else {
                        statusEl.className = 'status inactive';
                        statusEl.textContent = 'å·²åœæ­¢';
                        showToast('è‡ªå‹•åµæ¸¬å·²åœæ­¢');
                    }
                }
            } catch (e) {
                switchEl.checked = !switchEl.checked;
                showToast('æ“ä½œå¤±æ•—');
            }
        }
        
        async function setDetectionInterval() {
            const interval = parseInt(document.getElementById('intervalInput').value);
            if (interval < 5 || interval > 300) {
                showToast('é–“éš”å¿…é ˆåœ¨ 5-300 ç§’ä¹‹é–“');
                return;
            }
            
            try {
                await fetch(`${API_BASE}/api/scheduler/interval`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ interval })
                });
                showToast(`åµæ¸¬é–“éš”å·²è¨­ç‚º ${interval} ç§’`);
            } catch (e) {
                console.error('è¨­å®šé–“éš”å¤±æ•—', e);
            }
        }
        
        // ========================================
        // å¸¸ç”¨ç‰©å“ç®¡ç†
        // ========================================
        
        const DEFAULT_QUICK_ITEMS = [
            { name: 'æ‰‹æ©Ÿ', icon: 'ğŸ“±', order: 1 },
            { name: 'é‘°åŒ™', icon: 'ğŸ”‘', order: 2 },
            { name: 'çœ¼é¡', icon: 'ğŸ‘“', order: 3 },
            { name: 'éŒ¢åŒ…', icon: 'ğŸ‘›', order: 4 }
        ];
        
        function getQuickItems() {
            const saved = localStorage.getItem('quickItems');
            return saved ? JSON.parse(saved) : DEFAULT_QUICK_ITEMS;
        }
        
        function saveQuickItems(items) {
            localStorage.setItem('quickItems', JSON.stringify(items));
        }
        
        function loadQuickItems() {
            renderQuickItemsList(getQuickItems());
        }
        
        function renderQuickItemsList(items) {
            const container = document.getElementById('quickItemsList');
            if (items.length === 0) {
                container.innerHTML = '<p style="color:#aaa;">å°šæœªè¨­å®šå¸¸ç”¨ç‰©å“</p>';
                return;
            }
            
            container.innerHTML = items.map(item => `
                <div style="display:inline-flex; align-items:center; gap:8px; background:rgba(255,215,0,0.2); padding:8px 12px; border-radius:20px; font-size:14px;">
                    <span>${item.icon}</span>
                    <span>${item.name}</span>
                    <button onclick="removeQuickItem('${item.name}')" style="background:rgba(245,87,108,0.5); border:none; color:#fff; width:20px; height:20px; border-radius:50%; cursor:pointer; font-size:12px;">âœ•</button>
                </div>
            `).join('');
        }
        
        function addQuickItem() {
            const name = document.getElementById('newQuickItemName').value.trim();
            const icon = document.getElementById('newQuickItemIcon').value.trim() || 'ğŸ“¦';
            const order = parseInt(document.getElementById('newQuickItemOrder').value) || 1;
            
            if (!name) { alert('è«‹è¼¸å…¥ç‰©å“åç¨±'); return; }
            
            const items = getQuickItems();
            if (items.find(i => i.name === name)) {
                showToast('ç‰©å“å·²å­˜åœ¨');
                return;
            }
            
            items.push({ name, icon, order });
            items.sort((a, b) => a.order - b.order);
            saveQuickItems(items);
            
            document.getElementById('newQuickItemName').value = '';
            document.getElementById('newQuickItemIcon').value = '';
            
            showToast(`å·²æ–°å¢: ${icon} ${name}`);
            loadQuickItems();
        }
        
        function removeQuickItem(name) {
            if (!confirm(`ç¢ºå®šè¦ç§»é™¤ã€Œ${name}ã€ï¼Ÿ`)) return;
            
            let items = getQuickItems();
            items = items.filter(i => i.name !== name);
            saveQuickItems(items);
            
            showToast(`å·²ç§»é™¤: ${name}`);
            loadQuickItems();
        }
        
        // ========================================
        // å·¥å…·å‡½æ•¸
        // ========================================
        
        function showToast(msg) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
        
        // åˆå§‹åŒ–
        loadObjects();
        loadConfig();
        loadAvailableCameras();
        loadSchedulerStatus();
        loadQuickItems();
    </script>
</body>
</html>
